---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docker-compose.yml
  - backend/Dockerfile
  - backend/requirements.txt
  - frontend/Dockerfile
  - frontend/package.json
  - frontend/index.html
  - .env.example
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "docker-compose up starts Redis, FastAPI, and frontend containers"
    - "Redis has RediSearch and RedisJSON modules loaded"
    - "Redis has AOF persistence enabled"
    - "FastAPI responds on port 8000"
    - "Frontend dev server responds on port 5173"
  artifacts:
    - path: "docker-compose.yml"
      provides: "Service orchestration for Redis, FastAPI, Frontend"
      contains: "redis/redis-stack"
    - path: "backend/Dockerfile"
      provides: "FastAPI container image"
      contains: "uvicorn"
    - path: "backend/requirements.txt"
      provides: "Python dependencies"
      contains: "fastapi"
    - path: "frontend/Dockerfile"
      provides: "Frontend container image"
      contains: "node"
    - path: ".env.example"
      provides: "Environment variable template"
      contains: "REDIS_URL"
  key_links:
    - from: "docker-compose.yml"
      to: "backend/Dockerfile"
      via: "build context"
      pattern: "build.*backend"
    - from: "docker-compose.yml"
      to: ".env.example"
      via: "env_file reference"
      pattern: "env_file"
---

<objective>
Set up Docker Compose infrastructure with Redis 7+ (vector search + persistence), FastAPI container, and frontend dev server stub.

Purpose: One-command startup for all services — the foundation everything else depends on.
Output: docker-compose.yml, Dockerfiles, requirements.txt, .env.example
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Docker Compose with Redis Stack and service definitions</name>
  <files>docker-compose.yml, .env.example, .gitignore</files>
  <action>
    Create `docker-compose.yml` with three services:

    **redis:**
    - Image: `redis/redis-stack:7.4-latest` (includes RediSearch + RedisJSON)
    - Ports: 6379:6379 (Redis), 8001:8001 (RedisInsight)
    - Volumes: `redis-data:/data` for persistence
    - Command: `redis-server --appendonly yes --loadmodule /opt/redis-stack/lib/redisearch.so --loadmodule /opt/redis-stack/lib/rejson.so`
    - Health check: `redis-cli ping` every 10s, 5 retries
    - Environment: none needed (default config)

    **backend:**
    - Build from `./backend`
    - Ports: 8000:8000
    - Depends on: redis (condition: service_healthy)
    - env_file: .env
    - Volumes: `./backend:/app` for hot-reload in dev
    - Command: `uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload`

    **frontend:**
    - Build from `./frontend`
    - Ports: 5173:5173
    - Volumes: `./frontend:/app` and `/app/node_modules` anonymous volume
    - Command: `npm run dev -- --host 0.0.0.0`

    Create `.env.example` with all environment variables:
    ```
    # Redis
    REDIS_URL=redis://redis:6379/0

    # API
    API_KEY=your-api-key-here
    API_HOST=0.0.0.0
    API_PORT=8000

    # External Services (Phase 3+)
    DAILY_API_KEY=
    DEEPGRAM_API_KEY=
    OPENAI_API_KEY=
    CARTESIA_API_KEY=
    TWILIO_ACCOUNT_SID=
    TWILIO_AUTH_TOKEN=
    TWILIO_PHONE_NUMBER=

    # Logging
    LOG_LEVEL=INFO
    HIPAA_AUDIT_LOG=true
    ```

    Update `.gitignore` to include: `.env`, `__pycache__`, `*.pyc`, `.pytest_cache`, `node_modules`, `redis-data`, `.venv`
  </action>
  <verify>
    Run `docker compose config` and verify it parses without errors.
    Verify `.env.example` exists with REDIS_URL, API_KEY, and service keys.
    Verify `.gitignore` includes `.env` and `__pycache__`.
  </verify>
  <done>
    docker-compose.yml defines redis (redis-stack with health check), backend (FastAPI), and frontend services. .env.example lists all required environment variables.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create backend Dockerfile and requirements, frontend stub</name>
  <files>backend/Dockerfile, backend/requirements.txt, backend/app/__init__.py, backend/app/main.py, frontend/Dockerfile, frontend/package.json, frontend/index.html, frontend/src/main.js</files>
  <action>
    Create `backend/Dockerfile`:
    ```dockerfile
    FROM python:3.11-slim
    WORKDIR /app
    COPY requirements.txt .
    RUN pip install --no-cache-dir -r requirements.txt
    COPY . .
    CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
    ```

    Create `backend/requirements.txt`:
    ```
    fastapi==0.115.6
    uvicorn[standard]==0.34.0
    pydantic==2.10.4
    pydantic-settings==2.7.1
    redis[hiredis]==5.2.1
    python-dotenv==1.0.1
    httpx==0.28.1
    ```

    Create minimal `backend/app/__init__.py` (empty).

    Create minimal `backend/app/main.py` with just enough to start:
    ```python
    from fastapi import FastAPI

    app = FastAPI(title="Assort Health API", version="0.1.0")

    @app.get("/health")
    async def health():
        return {"status": "ok"}
    ```

    Create `frontend/Dockerfile`:
    ```dockerfile
    FROM node:20-slim
    WORKDIR /app
    COPY package.json .
    RUN npm install
    COPY . .
    CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]
    ```

    Create `frontend/package.json` with Vite as dev dependency (minimal scaffold — full React setup in Phase 6):
    ```json
    {
      "name": "assort-health-dashboard",
      "version": "0.1.0",
      "private": true,
      "scripts": {
        "dev": "vite",
        "build": "vite build"
      },
      "devDependencies": {
        "vite": "^6.0.0"
      }
    }
    ```

    Create `frontend/index.html` with basic HTML placeholder:
    ```html
    <!DOCTYPE html>
    <html lang="en">
    <head><meta charset="UTF-8"><title>Assort Health</title></head>
    <body><div id="app"><h1>Assort Health Dashboard</h1><p>Frontend will be built in Phase 6.</p></div></body>
    </html>
    ```
  </action>
  <verify>
    Verify all files exist: `ls backend/Dockerfile backend/requirements.txt backend/app/main.py frontend/Dockerfile frontend/package.json frontend/index.html`.
    Run `python -c "import ast; ast.parse(open('backend/app/main.py').read())"` to validate Python syntax.
  </verify>
  <done>
    Backend has Dockerfile, requirements.txt, and minimal FastAPI app. Frontend has Dockerfile, package.json with Vite, and placeholder index.html.
  </done>
</task>

</tasks>

<verification>
- `docker compose config` parses successfully
- All files exist in correct locations
- Python syntax is valid
- Package.json is valid JSON
</verification>

<success_criteria>
Docker Compose configuration is ready. Running `docker-compose up` would start all three services (actual verification of running containers happens end-to-end in Plan 03).
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
