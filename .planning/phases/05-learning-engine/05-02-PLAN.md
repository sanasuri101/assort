# 05-02: Pattern Extraction & Knowledge Candidates

**Goal**: Transform raw analysis data into structured "Knowledge Candidates" for the review queue.

**Depends on**: 05-01

## Requirements
- **Candidate Generation**: Identify questions that were not answered or answered vaguely.
- **Deduplication**: Don't flood the queue with duplicate questions ("Do you have wifi?" vs "Is there wifi?"). Use semantic similarity or simple key matching? (For v1, standard dedupe by exact question text or simple normalization).
- **Storage**: Store candidates in a Redis List or Sorted Set `candidates:knowledge`.

## Implementation Details

### 1. Candidate Logic (`app/learning/analysis.py`)
- Enhance `CallAnalyzer`:
    - If `missing_info` is detected, generate a proposed Q&A pair.
    - Example: User asked "Do you have wifi?", Bot said "I don't know". Analyzer proposes Q: "Do you offer Wi-Fi?" A: "[DRAFT ANSWER - PLEASE EDIT]" or infer from context if user provided it.

### 2. Worker Updates (`app/worker.py`)
- In the processing loop:
    - If analysis contains `knowledge_candidates`:
        - Push to `candidates:knowledge` list.
        - Store candidate details (source call ID, confidence) in `candidate:{id}`.

### 3. Safety Filter (Strict PII)
- Implement rigorous PII scrubbing before candidates enter the queue.
- Patterns to redact: SSN, Credit Cards, Phone Numbers, Date of Birth, Patient Names (spacy or regex), Email Addresses.
- **Rule**: Any candidate containing potential PHI is flagged/dropped to prevent compliance violations in the KB.

## Verification
- **Unit Tests**: `tests/learning/test_candidates.py`.
- **Manual**: Simulate a call asking for a non-existent amenity. Verify usage of worker results in a new candidate in Redis.
